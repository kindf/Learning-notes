---
title: "进程"
date: 2020-01-12T16:16:47+08:00
draft: true
---

> #### fork()函数
> fork()函数会产生一个和父进程完全相同的子进程,并在父进程返回子进程的pid号,在子进程返回0,失败时返回-1  

> #### vfork()函数
> vfork()与fork()区别于vfork()创建的子进程是共享父进程空间的,vfork()会保证子进程先执行,在调用exit或exec后父进程才有可能被调度
> vfork()创建的子进程有可能在父进程执行之前改变父进程地址空间,因此是不安全的  
> vfork()创建的子进程如果在调用exit或exec之前依赖于父进程的进一步动作,则会导致死锁  

> #### 写时复制(copy-on-write)  
> fork()后一般会执行exec()函数(一共6个函数),其作用是根据指定的文件名找到可执行文件,并用它来取代调用进程的内容  
> 因为大多数情况下fork()后都会执行exec(),这导致fork()做了许多无用功(对父进程数据空间、堆和栈的复品),为提高效率,才引入写时复制的技术  
> 写时复制是指父进程fork子进程后,并不是直接在内存中copy与父进程一样的进程,而是共享父进程的进程空间(因此虚拟地址不相同,物理地址相同)  
> 当其中一个进程发生写操作时,内核才为有关部分，典型的是虚存系统中的“页”，做一个拷贝  

> #### 僵尸进程  
> 子进程结束运行时操作系统会以SIGCHLD信号将该信息告知父进程, 此时父进程应调用wait(或waitpid)获取子进程退出状态并释放子进程的资源(PCB)  
> 当子进程结束运行而父进程并没有执行相关的操作时,子进程的PCB会驻留在内存,成为僵尸进程(进程状态为Z的进程)  
> 当进程终止时,该进程的所有僵尸进程的父进程id都会被重置为1(init进程),init进程会进行清理工作   

> #### 孤儿进程
> 当一个父进程结束运行而其子进程还在继续运行,这些子进程就会变成孤儿进程  
> 由于孤儿进程的父进程id会在父进程退出后被重置为1(init进程),直到运行结束被init进程回收资源,故并没危害  